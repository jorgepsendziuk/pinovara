generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  schemas  = ["pinovara", "pinovara_aux"]
}

model User {
  id        Int        @id @default(autoincrement())
  email     String     @unique
  password  String
  name      String
  active    Boolean    @default(true)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  auditLogs AuditLog[]
  userRoles UserRole[]

  @@map("users")
  @@schema("pinovara")
}

model Module {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  roles       Role[]

  @@map("modules")
  @@schema("pinovara")
}

model Role {
  id          Int        @id @default(autoincrement())
  name        String
  description String?
  active      Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  moduleId    Int
  module      Module     @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  userRoles   UserRole[]

  @@unique([name, moduleId])
  @@map("roles")
  @@schema("pinovara")
}

model UserRole {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId    Int
  roleId    Int
  role      Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@map("user_roles")
  @@schema("pinovara")
}

model SystemSetting {
  id          Int      @id @default(autoincrement())
  key         String   @unique
  value       String
  type        String
  description String?
  category    String   @default("general")
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("system_settings")
  @@schema("pinovara")
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  action    String
  entity    String
  entityId  String? @map("entity_id")
  oldData   String? @map("old_data")
  newData   String? @map("new_data")
  userAgent String? @map("user_agent")
  ipAddress String? @map("ip_address")
  createdAt DateTime @default(now())
  userId    Int? @map("user_id")
  user      User?    @relation(fields: [userId], references: [id])

  @@map("audit_logs")
  @@schema("pinovara")
}

model Organizacao {
  id                                Int                @id @default(autoincrement())
  inicio                            DateTime?
  fim                               DateTime?
  deviceid                          String?
  dataVisita                        DateTime? @map("data_visita")
  estado                            Int?
  municipio                         Int?
  gpsLat                            Float?   @map("gps_lat")
  gpsLng                            Float?   @map("gps_lng")
  gpsAlt                            Float?   @map("gps_alt")
  gpsAcc                            Float?   @map("gps_acc")
  nome                              String?
  cnpj                              String?
  dataFundacao                      DateTime? @map("data_fundacao")
  caracteristicasNTotalSocios       Int? @map("caracteristicas_n_total_socios")
  caracteristicasNTotalSociosCaf    Int? @map("caracteristicas_n_total_socios_caf")
  caracteristicasNDistintosCaf      Int? @map("caracteristicas_n_distintos_caf")
  caracteristicasNSociosPaa         Int? @map("caracteristicas_n_socios_paa")
  caracteristicasNNaosociosPaa      Int? @map("caracteristicas_n_naosocios_paa")
  caracteristicasNSociosPnae        Int? @map("caracteristicas_n_socios_pnae")
  caracteristicasNNaosociosPnae     Int? @map("caracteristicas_n_naosocios_pnae")
  caracteristicasNAtivosTotal       Int? @map("caracteristicas_n_ativos_total")
  caracteristicasNAtivosCaf         Int? @map("caracteristicas_n_ativos_caf")
  caracteristicasNNaosocioOpTotal   Int? @map("caracteristicas_n_naosocio_op_total")
  caracteristicasNNaosocioOpCaf     Int? @map("caracteristicas_n_naosocio_op_caf")
  caracteristicasTaAMulher          Int? @map("caracteristicas_ta_a_mulher")
  caracteristicasTaAHomem           Int? @map("caracteristicas_ta_a_homem")
  caracteristicasTaEMulher          Int? @map("caracteristicas_ta_e_mulher")
  caracteristicasTaEHomem           Int? @map("caracteristicas_ta_e_homem")
  caracteristicasTaOMulher          Int? @map("caracteristicas_ta_o_mulher")
  caracteristicasTaOHomem           Int? @map("caracteristicas_ta_o_homem")
  caracteristicasTaIMulher          Int? @map("caracteristicas_ta_i_mulher")
  caracteristicasTaIHomem           Int? @map("caracteristicas_ta_i_homem")
  caracteristicasTaPMulher          Int? @map("caracteristicas_ta_p_mulher")
  caracteristicasTaPHomem           Int? @map("caracteristicas_ta_p_homem")
  caracteristicasTaAfMulher         Int? @map("caracteristicas_ta_af_mulher")
  caracteristicasTaAfHomem          Int? @map("caracteristicas_ta_af_homem")
  caracteristicasTaQMulher          Int? @map("caracteristicas_ta_q_mulher")
  caracteristicasTaQHomem           Int? @map("caracteristicas_ta_q_homem")
  caracteristicasTaCafConvencional  Int? @map("caracteristicas_ta_caf_convencional")
  caracteristicasTaCafAgroecologico Int? @map("caracteristicas_ta_caf_agroecologico")
  caracteristicasTaCafTransicao     Int? @map("caracteristicas_ta_caf_transicao")
  caracteristicasTaCafOrganico      Int? @map("caracteristicas_ta_caf_organico")

  @@map("pinovara")
  @@schema("pinovara")
}